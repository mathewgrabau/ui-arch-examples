<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8">
    <title>My Vue App</title>
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
</head>

<body>
    <div id="app">
        <div v-if="viewModel.showLoginButton"><button id="login" v-on:click="doLogin">Login</button></div>
        <div v-if="viewModel.showLogoutButton"><button id="logout" v-on:click="doLogout">Logout</button></div>
    </div>

    <script>
        window.onload = () => {
            console.log('window loaded');

            // These operations can be easily stubbed/mocked in your unit tests.
            const authService = {
                /**
                 * @brief Perform the login operation.
                 * @returns {Promise<string>} The auth token.
                 */
                async login() {
                    // simulate a delay
                    await new Promise(resolve => setTimeout(resolve, 1000));
                    return 'my-auth-token';
                },
                /**
                 * @brief Perform the logout operation.
                 * @returns {Promise<void>}
                 */
                async logout() {
                    // simulate a delay
                    await new Promise(resolve => setTimeout(resolve, 1000));
                }
            };

            const { createApp } = Vue;

            class viewModel {
                showLoginButton = true;
                showLogoutButton = false;
                constructor(authServiceInstance) {
                    this.authToken = null;
                    this.authServiceInstance = authServiceInstance;
                }

                async doLogin() {
                    this.authToken = await this.authServiceInstance.login();
                    this.showLoginButton = this.authToken == null;
                    this.showLogoutButton = !this.showLoginButton;
                }

                async doLogout() {
                    await this.authServiceInstance.logout();
                    this.authToken = null;
                    this.showLoginButton = true;
                    this.showLogoutButton = false;
                }
            }

            // The component contains glue logic.
            const viewModelInstance = new viewModel(authService);

            const app = createApp({
                data() {
                    return {
                        // Note the coupling between the component and the view model. However, it's drastically reduced compared to the original code.
                        viewModel: viewModelInstance,
                    };
                },
                methods: {
                    async doLogin() {
                        //this.authToken = //await authService.login();
                        await this.viewModel.doLogin();
                    },
                    async doLogout() {
                        //await authService.logout();
                        //this.authToken = null;
                        await this.viewModel.doLogout();
                    }
                }
            });
            app.mount('#app');
        };

    </script>
</body>

</html>